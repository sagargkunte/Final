
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patient Dashboard - Find Your Doctor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
        }
        
        .glass-effect {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.85);
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.6);
        }
        
        .card {
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.6);
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(31, 38, 135, 0.2);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6, #6366f1);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #2563eb, #4f46e5);
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(59, 130, 246, 0.3);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #10b981, #059669);
            transition: all 0.3s ease;
        }
        
        .btn-secondary:hover {
            background: linear-gradient(135deg, #059669, #047857);
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(16, 185, 129, 0.3);
        }
        
        .input-field {
            transition: all 0.2s ease;
        }
        
        .input-field:focus {
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .status-approved {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }
        
        .status-pending {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }
        
        .status-rejected {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }
        
        .specialty-badge {
            background: linear-gradient(135deg, #3b82f6, #6366f1);
            color: white;
        }
        
        /* Floating MediAI Button */
        .medi-ai-button {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
            animation: float 3s ease-in-out infinite;
            transition: all 0.3s ease;
        }
        
        .medi-ai-button:hover {
            transform: scale(1.1);
            animation: none;
        }
        
        @keyframes float {
            0% {
                transform: translateY(0px);
            }
            50% {
                transform: translateY(-10px);
            }
            100% {
                transform: translateY(0px);
            }
        }
        
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.4);
            }
            70% {
                box-shadow: 0 0 0 15px rgba(59, 130, 246, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(59, 130, 246, 0);
            }
        }
        
        .glow {
            box-shadow: 0 0 20px rgba(139, 92, 246, 0.5);
        }
        
        /* MediAI Chatbot Styles - LARGER SIZE */
        #medi-ai-chatbot {
            position: fixed;
            bottom: 100px;
            right: 30px;
            width: 500px;
            height: 650px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.25);
            z-index: 999;
            display: none;
            flex-direction: column;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.6);
        }
        
        #medi-ai-chatbot.active {
            display: flex;
        }
        
        .chat-header {
            background: linear-gradient(135deg, #3b82f6, #6366f1);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .chat-body {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: #f9fafb;
            font-size: 15px;
        }
        
        .chat-footer {
            padding: 20px;
            border-top: 1px solid #e5e7eb;
            background: white;
        }
        
        .message {
            margin-bottom: 20px;
            display: flex;
        }
        
        .message.user {
            justify-content: flex-end;
        }
        
        .message.bot {
            justify-content: flex-start;
        }
        
        .message-content {
            max-width: 85%;
            padding: 16px 20px;
            border-radius: 20px;
            font-size: 15px;
            line-height: 1.5;
        }
        
        .message.user .message-content {
            background: linear-gradient(135deg, #3b82f6, #6366f1);
            color: white;
            border-bottom-right-radius: 6px;
        }
        
        .message.bot .message-content {
            background: white;
            color: #374151;
            border: 1px solid #e5e7eb;
            border-bottom-left-radius: 6px;
        }
        
        .chat-input {
            display: flex;
            gap: 12px;
        }
        
        .chat-input input {
            flex: 1;
            padding: 16px 20px;
            border: 1px solid #d1d5db;
            border-radius: 28px;
            outline: none;
            font-size: 15px;
        }
        
        .chat-input input:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .chat-input button {
            background: linear-gradient(135deg, #3b82f6, #6366f1);
            color: white;
            border: none;
            border-radius: 50%;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 18px;
        }
        
        .chat-input button:hover {
            background: linear-gradient(135deg, #2563eb, #4f46e5);
            transform: translateY(-2px);
        }
        
        .find-doctors-btn {
            width: 100%;
            margin-top: 20px;
            padding: 16px;
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .find-doctors-btn:hover {
            background: linear-gradient(135deg, #059669, #047857);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(16, 185, 129, 0.3);
        }
        
        .close-chat {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 22px;
        }

        /* AI Response Styling */
        .ai-response {
            background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
            border: 1px solid #bfdbfe;
            border-radius: 12px;
            padding: 16px;
            margin-top: 8px;
        }

        .ai-section {
            margin-bottom: 12px;
        }

        .ai-section-title {
            font-weight: 600;
            color: #1e40af;
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .ai-section-content {
            color: #374151;
            font-size: 14px;
            line-height: 1.6;
        }

        .ai-list {
            list-style: none;
            padding-left: 0;
        }

        .ai-list li {
            padding: 4px 0;
            padding-left: 20px;
            position: relative;
        }

        .ai-list li:before {
            content: "•";
            color: #3b82f6;
            font-weight: bold;
            position: absolute;
            left: 0;
        }

        .ai-disclaimer {
            background: #fef3c7;
            border: 1px solid #fbbf24;
            border-radius: 8px;
            padding: 10px;
            margin-top: 12px;
            font-size: 13px;
            color: #92400e;
        }

        .ai-warning {
            background: #fee2e2;
            border: 1px solid #fca5a5;
            border-radius: 8px;
            padding: 10px;
            margin-top: 12px;
            font-size: 13px;
            color: #991b1b;
        }

        .ai-emergency {
            background: #dc2626;
            color: white;
            border-radius: 8px;
            padding: 12px;
            margin-top: 12px;
            font-size: 14px;
            font-weight: 600;
        }

        .ai-loading {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #6b7280;
            font-style: italic;
        }

        .ai-loading-dots {
            display: flex;
            gap: 4px;
        }

        .ai-loading-dots span {
            width: 8px;
            height: 8px;
            background: #3b82f6;
            border-radius: 50%;
            animation: bounce 1.4s infinite ease-in-out both;
        }

        .ai-loading-dots span:nth-child(1) {
            animation-delay: -0.32s;
        }

        .ai-loading-dots span:nth-child(2) {
            animation-delay: -0.16s;
        }

        @keyframes bounce {
            0%, 80%, 100% {
                transform: scale(0);
            }
            40% {
                transform: scale(1);
            }
        }

        /* Quick Response Button Styles */
        .quick-responses {
            display: flex;
            gap: 8px;
            margin-top: 12px;
            flex-wrap: wrap;
        }

        .quick-response-btn {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.2s ease;
            cursor: pointer;
            border: none;
        }

        .quick-response-btn.common {
            background: #dbeafe;
            color: #1e40af;
        }

        .quick-response-btn.common:hover {
            background: #bfdbfe;
        }

        .quick-response-btn.serious {
            background: #fee2e2;
            color: #991b1b;
        }

        .quick-response-btn.serious:hover {
            background: #fecaca;
        }

        .quick-response-btn.emergency {
            background: #dc2626;
            color: white;
        }

        .quick-response-btn.emergency:hover {
            background: #b91c1c;
        }

        /* Responsive adjustments for smaller screens */
        @media (max-width: 640px) {
            #medi-ai-chatbot {
                width: 90vw;
                height: 70vh;
                right: 5vw;
                bottom: 80px;
            }
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50">
    <!-- MediAI Chatbot -->
    <div id="medi-ai-chatbot">
        <div class="chat-header">
            <div class="flex items-center">
                <div class="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center mr-3">
                    <i class="fas fa-robot text-lg"></i>
                </div>
                <div>
                    <h3 class="font-bold text-lg">MediAI Assistant</h3>
                    <p class="text-sm text-blue-100">Online • Ready to help</p>
                </div>
            </div>
            <button class="close-chat" id="close-chat">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="chat-body" id="chat-body">
            <div class="message bot">
                <div class="message-content">
                    <p>Hello! I'm MediAI, your healthcare assistant. How can I help you today?</p>
                    <p class="mt-3 text-sm text-gray-500">You can describe your symptoms, ask about medications, or get health information including serious conditions.</p>
                </div>
            </div>
        </div>
        <div class="chat-footer">
            <form id="chat-form" class="chat-input">
                <input type="text" id="chat-input" placeholder="Describe your symptoms or health concern..." autocomplete="off">
                <button type="submit">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </form>
            <button class="find-doctors-btn" id="find-doctors-btn" onclick="findNearDoctorForm()">
                <i class="fas fa-user-md mr-2"></i> Find Nearest Doctors
            </button>
        </div>
    </div>

    <!-- Floating MediAI Button -->
    <div class="medi-ai-button">
        <a href="#" id="open-chat" 
           class="flex items-center justify-center w-16 h-16 rounded-full bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-2xl glow pulse-animation hover:from-blue-700 hover:to-purple-700 transition-all duration-300">
            <i class="fas fa-robot text-xl"></i>
        </a>
        <div class="absolute -top-10 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white text-xs font-medium px-2 py-1 rounded-lg opacity-0 transition-opacity duration-300 medi-ai-button:hover:opacity-100 whitespace-nowrap">
            Talk to MediAI
        </div>
    </div>

    <!-- Header -->
    <header class="glass-effect shadow-sm border-b border-white/50 sticky top-0 z-50">
        <div class="container mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <!-- Left: Logo and Title -->
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 rounded-full bg-gradient-to-r from-blue-600 to-indigo-600 flex items-center justify-center">
                        <i class="fas fa-stethoscope text-white text-xl"></i>
                    </div>
                    <h1 class="text-2xl font-bold text-gray-800">MediCare Hub</h1>
                </div>

                <!-- Right: User Info + Logout -->
                <div class="flex items-center space-x-4">
                    <span class="text-gray-700">
                        Welcome, 
                        <span class="font-semibold text-blue-600">
                            <%= patientName || 'Patient' %>
                        </span>
                    </span>
                    
                    <!-- Avatar -->
                    <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-semibold shadow-md">
                        <%= (patientName || 'P').charAt(0).toUpperCase() %>
                    </div>
                    
                    <!-- Logout Button -->
                    <button id="logout-btn" class="px-4 py-2 bg-red-500 hover:bg-red-700 text-gray-700 rounded-lg font-medium transition duration-200 flex items-center">
                        <i class="fas fa-sign-out-alt mr-2"></i>Logout
                    </button>
                </div>
            </div>
        </div>
    </header>

    <div class="container mx-auto px-4 py-8">
        <!-- Main Content -->
        <div class="glass-effect card rounded-2xl p-6 mb-8">
            <!-- Header Section -->
            <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center mb-8 space-y-4 lg:space-y-0">
                <div>
                    <h2 class="text-2xl font-bold text-gray-800 flex items-center">
                        <i class="fas fa-user-doctor mr-3 text-blue-600"></i>
                        Available Doctors
                        <span class="ml-3 bg-blue-100 text-blue-800 text-sm font-semibold px-3 py-1 rounded-full">
                            <%= doctors.length %> Doctors
                        </span>
                    </h2>
                    <p class="text-gray-600 mt-2">Find the right specialist for your health needs</p>
                </div>
                <div class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-4 w-full lg:w-auto">
                    <div class="relative flex-1 sm:flex-none">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <i class="fas fa-search text-gray-400"></i>
                        </div>
                        <input type="text" placeholder="Search by name..." 
                               class="input-field w-full sm:w-64 pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-400 focus:outline-none">
                    </div>
                    <select class="input-field border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-400 focus:outline-none bg-white">
                        <option>Filter by Status</option>
                        <option>Approved</option>
                        <option>Pending</option>
                        <option>All Doctors</option>
                    </select>
                </div>
            </div>

            <!-- Doctors Grid -->
            <div class="grid grid-cols-1 xl:grid-cols-2 gap-6">
                <% if (doctors && doctors.length > 0) { %>
                    <% doctors.forEach(doctor => { %>
                        <div class="glass-effect card rounded-2xl p-6">
                            <div class="flex items-start space-x-5">
                                <!-- Doctor Avatar with Status -->
                                <div class="flex-shrink-0 relative">
                                    <div class="w-20 h-20 bg-gradient-to-r from-blue-500 to-purple-600 rounded-2xl flex items-center justify-center text-white font-bold text-2xl shadow-lg">
                                        <%= doctor.name.charAt(0).toUpperCase() %>
                                    </div>
                                    <!-- Status Badge -->
                                    <div class="absolute -top-2 -right-2">
                                        <% if (doctor.status === 'approved') { %>
                                            <span class="status-approved text-xs font-bold px-2 py-1 rounded-full flex items-center">
                                                <i class="fas fa-check mr-1"></i> Approved
                                            </span>
                                        <% } else if (doctor.status === 'pending') { %>
                                            <span class="status-pending text-xs font-bold px-2 py-1 rounded-full flex items-center">
                                                <i class="fas fa-clock mr-1"></i> Pending
                                            </span>
                                        <% } else { %>
                                            <span class="status-rejected text-xs font-bold px-2 py-1 rounded-full flex items-center">
                                                <i class="fas fa-times mr-1"></i> Rejected
                                            </span>
                                        <% } %>
                                    </div>
                                </div>
                                
                                <!-- Doctor Info -->
                                <div class="flex-1 min-w-0">
                                    <div class="flex flex-col sm:flex-row sm:justify-between sm:items-start mb-3">
                                        <div>
                                            <h3 class="text-xl font-bold text-gray-800 truncate"><%= doctor.name %></h3>
                                            <span class="inline-block mt-1 px-3 py-1 text-xs font-semibold specialty-badge rounded-full">Medical Specialist</span>
                                        </div>
                                        <% if (doctor.doctorid) { %>
                                            <span class="bg-gray-100 text-gray-700 text-xs font-mono px-2 py-1 rounded-lg mt-1 sm:mt-0">
                                                ID: <%= doctor.doctorid %>
                                            </span>
                                        <% } %>
                                    </div>

                                    <!-- Contact Information -->
                                    <div class="space-y-3 mb-4">
                                        <div class="flex items-center text-sm text-gray-600">
                                            <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center mr-3">
                                                <i class="fas fa-envelope text-blue-600 text-xs"></i>
                                            </div>
                                            <span class="truncate"><%= doctor.email %></span>
                                        </div>
                                        <% if (doctor.phone) { %>
                                            <div class="flex items-center text-sm text-gray-600">
                                                <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center mr-3">
                                                    <i class="fas fa-phone text-blue-600 text-xs"></i>
                                                </div>
                                                <span><%= doctor.phone %></span>
                                            </div>
                                        <% } %>
                                        <% if (doctor.gender) { %>
                                            <div class="flex items-center text-sm text-gray-600">
                                                <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center mr-3">
                                                    <i class="fas fa-venus-mars text-blue-600 text-xs"></i>
                                                </div>
                                                <span class="capitalize"><%= doctor.gender %></span>
                                            </div>
                                        <% } %>
                                    </div>

                                    <!-- Action Buttons -->
                                    <div class="flex space-x-3 pt-4 border-t border-gray-100">
                                        <button class="flex-1 btn-primary text-white py-2 px-4 rounded-lg text-sm font-semibold transition duration-200 flex items-center justify-center shadow-md book-appointment-btn" 
                                                data-doctor-id="<%= doctor.doctorid %>" 
                                                data-doctor-name="<%= doctor.name %>">
                                            <i class="fas fa-calendar-check mr-2"></i>
                                            Book Appointment
                                        </button>
                                        <button class="px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 transition duration-200">
                                            <i class="fas fa-info-circle"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    <% }); %>
                <% } else { %>
                    <div class="col-span-2 text-center py-16">
                        <div class="max-w-md mx-auto">
                            <div class="w-16 h-16 rounded-full bg-blue-100 flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-user-md text-blue-600 text-2xl"></i>
                            </div>
                            <h3 class="text-2xl font-bold text-gray-600 mb-3">No Doctors Available</h3>
                            <p class="text-gray-500 mb-6">We don't have any doctors in our system at the moment. Please check back later.</p>
                            <button class="btn-primary text-white font-semibold py-3 px-6 rounded-lg transition duration-200">
                                <i class="fas fa-sync-alt mr-2"></i>
                                Refresh Page
                            </button>
                        </div>
                    </div>
                <% } %>
            </div>

            <!-- Load More/Pagination -->
            <% if (doctors && doctors.length > 0) { %>
                <div class="flex justify-center items-center space-x-4 mt-8 pt-6 border-t border-gray-200">
                    <button class="px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 transition duration-200 flex items-center">
                        <i class="fas fa-chevron-left mr-2"></i>
                        Previous
                    </button>
                    <span class="text-sm text-gray-600">Page 1 of 1</span>
                    <button class="px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 transition duration-200 flex items-center">
                        Next
                        <i class="fas fa-chevron-right ml-2"></i>
                    </button>
                </div>
            <% } %>
        </div>
    </div>

    <!-- Appointment Modal -->
    <div id="appointment-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="glass-effect rounded-2xl max-w-md w-full mx-4 border border-white/50">
            <!-- Modal Header -->
            <div class="bg-gradient-to-r from-blue-600 to-indigo-600 rounded-t-2xl p-6 text-white">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-bold flex items-center">
                        <i class="fas fa-calendar-plus mr-3"></i>
                        Book Appointment
                    </h3>
                    <button id="close-modal" class="text-white hover:text-gray-200 transition duration-200">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                <p class="mt-2 text-blue-100">Schedule an appointment with <span id="doctor-name" class="font-semibold"></span></p>
            </div>
            
            <!-- Modal Body -->
            <div class="p-6">
                <div id="bookingMessage" class="hidden mb-4 p-3 rounded-lg"></div>
                
                <form id="appointment-form">
                    <input type="hidden" id="doctor-id" name="doctorId">
                    
                    <!-- Patient Information -->
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Your Information</h3>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label for="patient-name" class="block text-sm font-medium text-gray-700 mb-1">Full Name *</label>
                                <input type="text" id="patient-name" name="patientName" required
                                       class="input-field w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-400 focus:outline-none">
                            </div>
                            <div>
                                <label for="patient-email" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                                <input type="email" id="patient-email" name="patientEmail"
                                       class="input-field w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-400 focus:outline-none">
                            </div>
                            <div>
                                <label for="patient-phone" class="block text-sm font-medium text-gray-700 mb-1">Phone *</label>
                                <input type="tel" id="patient-phone" name="patientPhone" required
                                       class="input-field w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-400 focus:outline-none">
                            </div>
                            <div>
                                <label for="patient-age" class="block text-sm font-medium text-gray-700 mb-1">Age</label>
                                <input type="number" id="patient-age" name="patientAge" min="1" max="120"
                                       class="input-field w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-400 focus:outline-none">
                            </div>
                            <div>
                                <label for="patient-gender" class="block text-sm font-medium text-gray-700 mb-1">Gender</label>
                                <select id="patient-gender" name="patientGender"
                                        class="input-field w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-400 focus:outline-none">
                                    <option value="">Select</option>
                                    <option value="male">Male</option>
                                    <option value="female">Female</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            <div class="col-span-2">
                                <label for="patient-address" class="block text-sm font-medium text-gray-700 mb-1">Address</label>
                                <input type="text" id="patient-address" name="patientAddress"
                                       class="input-field w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-400 focus:outline-none">
                            </div>
                        </div>
                    </div>

                    <!-- Urgency Level -->
                    <div class="mb-6">
                        <label class="block text-sm font-semibold text-gray-700 mb-3 flex items-center">
                            <i class="fas fa-exclamation-triangle mr-2 text-orange-500"></i>
                            Urgency Level
                        </label>
                        <div class="flex space-x-4 justify-between">
                            <label class="flex flex-col items-center cursor-pointer">
                                <input type="radio" name="urgency" value="low" class="text-green-600 focus:ring-green-500" checked>
                                <span class="mt-1 text-xs font-medium text-green-600">Low</span>
                                <div class="w-8 h-2 bg-green-200 rounded-full mt-1"></div>
                            </label>
                            <label class="flex flex-col items-center cursor-pointer">
                                <input type="radio" name="urgency" value="medium" class="text-yellow-600 focus:ring-yellow-500">
                                <span class="mt-1 text-xs font-medium text-yellow-600">Medium</span>
                                <div class="w-8 h-2 bg-yellow-200 rounded-full mt-1"></div>
                            </label>
                            <label class="flex flex-col items-center cursor-pointer">
                                <input type="radio" name="urgency" value="high" class="text-red-600 focus:ring-red-500">
                                <span class="mt-1 text-xs font-medium text-red-600">High</span>
                                <div class="w-8 h-2 bg-red-200 rounded-full mt-1"></div>
                            </label>
                        </div>
                    </div>
                    
                    <!-- Additional Notes / Description -->
                    <div class="mb-6">
                        <label for="appointment-notes" class="block text-sm font-semibold text-gray-700 mb-2 flex items-center">
                            <i class="fas fa-notes-medical mr-2 text-purple-600"></i>
                            Description / Additional Notes *
                        </label>
                        <textarea id="appointment-notes" name="description" rows="3" required
                                  class="input-field w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-400 focus:outline-none" 
                                  placeholder="Briefly describe the reason for your appointment..."></textarea>
                    </div>
                    
                    <!-- Submit Button -->
                    <button type="submit" 
                            class="w-full btn-primary text-white font-bold py-3 px-4 rounded-lg transition duration-200 flex items-center justify-center">
                        <i class="fas fa-paper-plane mr-3"></i>
                        Book Appointment
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="glass-effect border-t border-white/50 mt-12">
        <div class="container mx-auto px-4 py-6">
            <div class="text-center text-gray-600">
                <p>&copy; 2024 MediCare Hub. All rights reserved.</p>
                <p class="text-sm mt-2">Your trusted healthcare partner</p>
            </div>
        </div>
    </footer>

    <!-- JavaScript for interactivity -->
    <script>
        // Search functionality
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.querySelector('input[type="text"]');
            const doctorCards = document.querySelectorAll('.grid > div');
            
            if (searchInput) {
                searchInput.addEventListener('input', function(e) {
                    const searchTerm = e.target.value.toLowerCase();
                    
                    doctorCards.forEach(card => {
                        const doctorName = card.querySelector('h3').textContent.toLowerCase();
                        if (doctorName.includes(searchTerm)) {
                            card.style.display = 'block';
                        } else {
                            card.style.display = 'none';
                        }
                    });
                });
            }

            // Status filter functionality
            const statusFilter = document.querySelector('select');
            if (statusFilter) {
                statusFilter.addEventListener('change', function(e) {
                    const selectedStatus = e.target.value.toLowerCase();
                    
                    doctorCards.forEach(card => {
                        const statusBadge = card.querySelector('.status-approved, .status-pending, .status-rejected');
                        if (!statusBadge) return;
                        
                        const statusText = statusBadge.textContent.toLowerCase().trim();
                        
                        if (selectedStatus === 'all doctors' || selectedStatus === 'filter by status') {
                            card.style.display = 'block';
                        } else if (statusText.includes(selectedStatus)) {
                            card.style.display = 'block';
                        } else {
                            card.style.display = 'none';
                        }
                    });
                });
            }

            // Appointment Modal Functionality
            const modal = document.getElementById('appointment-modal');
            const closeModalBtn = document.getElementById('close-modal');
            const appointmentForm = document.getElementById('appointment-form');
            const doctorNameSpan = document.getElementById('doctor-name');
            const doctorIdInput = document.getElementById('doctor-id');
            
            // Open modal when clicking Book Appointment button
            document.querySelectorAll('.book-appointment-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const doctorId = this.getAttribute('data-doctor-id');
                    const doctorName = this.getAttribute('data-doctor-name');
                    
                    doctorIdInput.value = doctorId;
                    doctorNameSpan.textContent = doctorName;
                    
                    modal.classList.remove('hidden');
                });
            });
            
            // Close modal when clicking close button
            closeModalBtn.addEventListener('click', function() {
                modal.classList.add('hidden');
            });
            
            // Close modal when clicking outside
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.classList.add('hidden');
                }
            });
            
            // Handle form submission
            if (appointmentForm) {
                appointmentForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    const messageDiv = document.getElementById('bookingMessage');
                    const submitBtn = this.querySelector('button[type="submit"]');
                    const originalText = submitBtn.innerHTML;
                    
                    // Show loading
                    submitBtn.disabled = true;
                    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-3"></i>Booking...';
                    messageDiv.classList.add('hidden');
                    
                    // Get form data
                    const formData = {
                        doctorId: document.getElementById('doctor-id').value,
                        patientName: document.getElementById('patient-name').value,
                        patientEmail: document.getElementById('patient-email').value,
                        patientPhone: document.getElementById('patient-phone').value,
                        patientAge: document.getElementById('patient-age').value,
                        patientGender: document.getElementById('patient-gender').value,
                        patientAddress: document.getElementById('patient-address').value,
                        urgency: this.querySelector('input[name="urgency"]:checked').value,
                        description: document.getElementById('appointment-notes').value
                    };
                    
                    try {
                        const response = await fetch('/patientPage/book-appointment', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(formData)
                        });
                        
                        const data = await response.json();
                        
                        if (data.success) {
                            messageDiv.className = 'mb-4 p-3 rounded-lg bg-green-100 border border-green-400 text-green-700';
                            messageDiv.textContent = data.message;
                            messageDiv.classList.remove('hidden');
                            
                            // Reset form
                            this.reset();
                            
                            // Close modal after 2 seconds
                            setTimeout(() => {
                                modal.classList.add('hidden');
                                messageDiv.classList.add('hidden');
                            }, 2000);
                        } else {
                            messageDiv.className = 'mb-4 p-3 rounded-lg bg-red-100 border border-red-400 text-red-700';
                            messageDiv.textContent = data.message || 'Error booking appointment. Please try again.';
                            messageDiv.classList.remove('hidden');
                            submitBtn.disabled = false;
                            submitBtn.innerHTML = originalText;
                        }
                    } catch (error) {
                        messageDiv.className = 'mb-4 p-3 rounded-lg bg-red-100 border border-red-400 text-red-700';
                        messageDiv.textContent = 'Error booking appointment. Please try again.';
                        messageDiv.classList.remove('hidden');
                        submitBtn.disabled = false;
                        submitBtn.innerHTML = originalText;
                    }
                });
            }
            
            // Logout functionality
            const logoutBtn = document.getElementById('logout-btn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', function() {
                    // Show confirmation dialog
                    if (confirm('Are you sure you want to log out?')) {
                        // Redirect to logout endpoint
                        window.location.href = '/';
                    }
                });
            }

            // MediAI Chatbot Functionality
            const chatbot = document.getElementById('medi-ai-chatbot');
            const openChatBtn = document.getElementById('open-chat');
            const closeChatBtn = document.getElementById('close-chat');
            const chatForm = document.getElementById('chat-form');
            const chatInput = document.getElementById('chat-input');
            const chatBody = document.getElementById('chat-body');
            const findDoctorsBtn = document.getElementById('find-doctors-btn');

            // Conversation state
            let conversationHistory = [];
            let currentLevel = "initial";
            let originalSymptoms = "";
            let lastQueryType = "";
            let askedDuration = false;
            let askedSeverity = false;
            let askedRelatedSymptoms = false;

            // Open chatbot
            openChatBtn.addEventListener('click', function(e) {
                e.preventDefault();
                chatbot.classList.add('active');
                chatInput.focus();
            });

            // Close chatbot
            closeChatBtn.addEventListener('click', function() {
                chatbot.classList.remove('active');
                // Reset conversation when closed
                resetConversation();
            });

            // Reset conversation state
            function resetConversation() {
                conversationHistory = [];
                currentLevel = "initial";
                originalSymptoms = "";
                lastQueryType = "";
                askedDuration = false;
                askedSeverity = false;
                askedRelatedSymptoms = false;
                
                // Clear chat body except welcome message
                const messages = chatBody.querySelectorAll('.message');
                messages.forEach((msg, index) => {
                    if (index > 0) msg.remove();
                });
            }

            // Create contextual quick response buttons
            function createQuickResponses(queryType) {
                const quickResponses = document.createElement('div');
                quickResponses.className = 'quick-responses';
                
                let responses = [];
                
                // Check what questions we still need to ask
                if (queryType === "symptom_analysis" && !askedDuration) {
                    responses = [
                        { text: "2 days", action: "duration", type: "common" },
                        { text: "1 week", action: "duration", type: "common" },
                        { text: "2 weeks", action: "duration", type: "common" },
                        { text: "More than a month", action: "duration", type: "serious" }
                    ];
                } else if (!askedSeverity) {
                    responses = [
                        { text: "Mild (2-3/10)", action: "severity", type: "common" },
                        { text: "Moderate (4-6/10)", action: "severity", type: "common" },
                        { text: "Severe (7-8/10)", action: "severity", type: "serious" },
                        { text: "Very severe (9-10/10)", action: "severity", type: "emergency" }
                    ];
                } else if (!askedRelatedSymptoms) {
                    responses = [
                        { text: "I have fever too", action: "related", type: "common" },
                        { text: "I feel tired", action: "related", type: "common" },
                        { text: "I have body ache", action: "related", type: "common" },
                        { text: "No other symptoms", action: "related", type: "common" }
                    ];
                } else if (queryType === "more_details") {
                    responses = [
                        { text: "What could be serious?", action: "serious", type: "serious" },
                        { text: "Worst case scenarios", action: "worst", type: "emergency" },
                        { text: "What specialist should I see?", action: "specialist", type: "common" },
                        { text: "Give me home care tips", action: "home_care", type: "common" }
                    ];
                } else if (queryType === "specialist_recommendation") {
                    responses = [
                        { text: "General Physician", action: "doctor_type", type: "common" },
                        { text: "Specialist", action: "doctor_type", type: "common" },
                        { text: "Emergency Care", action: "emergency", type: "emergency" }
                    ];
                } else if (queryType === "hospital_request") {
                    responses = [
                        { text: "I'm in New York", action: "location", type: "common" },
                        { text: "I'm in California", action: "location", type: "common" },
                        { text: "I'm in Texas", action: "location", type: "common" },
                        { text: "Other location", action: "location_other", type: "common" }
                    ];
                } else {
                    responses = [
                        { text: "Yes, I have more symptoms", action: "more_symptoms", type: "common" },
                        { text: "Tell me more details", action: "more_details", type: "common" },
                        { text: "What could be serious?", action: "serious", type: "serious" },
                        { text: "Find nearest hospital", action: "hospital", type: "emergency" }
                    ];
                }
                
                responses.forEach(resp => {
                    const button = document.createElement('button');
                    button.className = `quick-response-btn ${resp.type}`;
                    button.textContent = resp.text;
                    button.onclick = () => handleQuickResponse(resp.action, resp.text);
                    quickResponses.appendChild(button);
                });
                
                return quickResponses;
            }

            // Handle quick response button clicks
            function handleQuickResponse(action, buttonText) {
                // Add user message
                addMessageToChat(buttonText, 'user');
                
                // Update flags based on action
                if (action === "duration") {
                    askedDuration = true;
                } else if (action === "severity") {
                    askedSeverity = true;
                } else if (action === "related") {
                    askedRelatedSymptoms = true;
                }
                
                // Update level based on action
                if (action === "more_symptoms" || action === "more_details") {
                    currentLevel = "detailed";
                } else if (action === "serious" || action === "worst" || action === "emergency") {
                    currentLevel = "comprehensive";
                }
                
                // Get AI response
                getAIResponse(buttonText);
            }

            // Get AI response with conversation context
            async function getAIResponse(message) {
                // Show typing indicator
                const typingMessage = document.createElement('div');
                typingMessage.className = 'message bot';
                typingMessage.innerHTML = `
                    <div class="message-content">
                        <div class="ai-loading">
                            <span>Thinking...</span>
                            <div class="ai-loading-dots">
                                <span></span>
                                <span></span>
                                <span></span>
                            </div>
                        </div>
                    </div>
                `;
                chatBody.appendChild(typingMessage);
                chatBody.scrollTop = chatBody.scrollHeight;
                
                try {
                    // Prepare request body
                    const requestBody = {
                        query: message,
                        history: conversationHistory,
                        level: currentLevel
                    };
                    
                    // Add context if we have original symptoms
                    if (originalSymptoms) {
                        requestBody.context = {
                            originalSymptoms: originalSymptoms,
                            lastQueryType: lastQueryType
                        };
                    }
                    
                    // Make API call
                    const response = await fetch('http://localhost:4040/mediAI/search', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(requestBody)
                    });
                    
                    const data = await response.json();
                    
                    // Remove typing indicator
                    chatBody.removeChild(typingMessage);
                    
                    if (data.success && data.response) {
                        // Store original symptoms if this is the first symptom analysis
                        if (data.queryType === "symptom_analysis" && !originalSymptoms) {
                            originalSymptoms = message;
                        }
                        
                        // Update last query type
                        lastQueryType = data.queryType;
                        
                        // Add to conversation history
                        conversationHistory.push(
                            { role: "user", content: message },
                            { role: "assistant", content: data.response }
                        );
                        
                        // Add AI response
                        const aiMessage = document.createElement('div');
                        aiMessage.className = 'message bot';
                        
                        let responseHTML = `<div class="message-content">${formatAIResponse(data.response)}</div>`;
                        
                        // Add quick response buttons if follow-up is needed
                        if (data.requiresFollowUp && !data.notTrained) {
                            responseHTML += createQuickResponses(data.queryType).outerHTML;
                        }
                        
                        // Add location input if asking for location
                        if (data.askingLocation) {
                            responseHTML += `
                                <div class="mt-3">
                                    <input type="text" id="location-input" 
                                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-400 focus:outline-none" 
                                           placeholder="Enter your city or locality...">
                                    <button onclick="submitLocation()" 
                                            class="mt-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                        <i class="fas fa-map-marker-alt mr-2"></i>Find Nearby Hospitals
                                    </button>
                                </div>
                            `;
                        }
                        
                        // Add special styling for "not trained" responses
                        if (data.notTrained) {
                            responseHTML = `
                                <div class="message-content">
                                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-2">
                                        <i class="fas fa-info-circle text-yellow-600 mr-2"></i>
                                        <span class="text-yellow-800">${formatAIResponse(data.response)}</span>
                                    </div>
                                    <div class="text-sm text-gray-600 mt-2">
                                        Would you like me to help you find a specialist for this topic?
                                    </div>
                                </div>
                            `;
                        }
                        
                        aiMessage.innerHTML = responseHTML;
                        chatBody.appendChild(aiMessage);
                        
                        // Update level if needed
                        if (data.level && data.level !== currentLevel) {
                            currentLevel = data.level;
                        }
                    } else {
                        addMessageToChat("I'm having trouble processing your request. Please try again later.", 'bot');
                    }
                } catch (error) {
                    console.error('Error:', error);
                    if (chatBody.contains(typingMessage)) {
                        chatBody.removeChild(typingMessage);
                    }
                    addMessageToChat("I'm having trouble connecting to my medical database. Please try again later.", 'bot');
                }
                
                chatBody.scrollTop = chatBody.scrollHeight;
            }

            // Submit location function
            window.submitLocation = function() {
                const locationInput = document.getElementById('location-input');
                if (locationInput) {
                    const location = locationInput.value.trim();
                    if (location) {
                        addMessageToChat(`I am located in ${location}`, 'user');
                        locationInput.remove();
                        getAIResponse(`I am located in ${location}`);
                    }
                }
            }

            // Format AI response with enhanced styling for serious conditions
            function formatAIResponse(response) {
                return response
                    .replace(/\*\*(.*?)\*\*/g, '<strong class="text-blue-700">$1</strong>')
                    .replace(/\*(.*?)\*/g, '<em class="text-gray-600">$1</em>')
                    .replace(/\n/g, '<br>')
                    .replace(/- (.*?)(?=<br>|$)/g, '<div class="ml-4">• $1</div>')
                    .replace(/(\d+\.) (.*?)(?=<br>|$)/g, '<div class="ml-4">$1 $2</div>')
                    // Enhanced formatting for serious conditions
                    .replace(/RARE BUT POSSIBLE:/g, '<div class="ai-emergency mt-3"><i class="fas fa-exclamation-triangle mr-2"></i><strong>RARE BUT POSSIBLE:</strong>')
                    .replace(/CRITICAL WARNING:/g, '<div class="ai-emergency mt-3"><i class="fas fa-exclamation-triangle mr-2"></i><strong>CRITICAL WARNING:</strong>')
                    .replace(/EMERGENCY:/g, '<div class="ai-emergency mt-3"><i class="fas fa-ambulance mr-2"></i><strong>EMERGENCY:</strong>')
                    .replace(/GO TO ER IMMEDIATELY/g, '<span class="font-bold uppercase">GO TO ER IMMEDIATELY</span>')
                    .replace(/IMMEDIATE ACTION REQUIRED/g, '<span class="font-bold uppercase text-red-600">IMMEDIATE ACTION REQUIRED</span>')
                    .replace(/RED FLAG SYMPTOMS:/g, '<div class="ai-warning mt-2"><strong>RED FLAG SYMPTOMS:</strong>')
                    .replace(/Note:/g, '<div class="mt-3 p-2 bg-gray-100 rounded text-sm text-gray-700"><i class="fas fa-info-circle mr-1"></i><strong>Note:</strong>')
                    .replace(/⚠️ MEDICAL DISCLAIMER:/g, '<div class="ai-disclaimer mt-3"><i class="fas fa-shield-alt mr-2"></i><strong>⚠️ MEDICAL DISCLAIMER:</strong>')
                    .replace(/Please consult a healthcare professional/g, 'Please consult a healthcare professional</div>');
            }

            // Handle chat form submission
            chatForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const message = chatInput.value.trim();
                if (!message) return;
                
                // Add user message to chat
                addMessageToChat(message, 'user');
                chatInput.value = '';
                
                // Check if user provided duration, severity, or related symptoms
                const lowerMessage = message.toLowerCase();
                if (lowerMessage.includes("day") || lowerMessage.includes("week") || lowerMessage.includes("month")) {
                    askedDuration = true;
                }
                if (lowerMessage.includes("severity") || lowerMessage.includes("scale") || /\d+\/10/.test(message)) {
                    askedSeverity = true;
                }
                if (lowerMessage.includes("also") || lowerMessage.includes("additional") || lowerMessage.includes("other symptom")) {
                    askedRelatedSymptoms = true;
                }
                
                // Auto-detect level based on message content
                if (lowerMessage.includes("very concerned") || 
                    lowerMessage.includes("worried") || 
                    lowerMessage.includes("emergency") ||
                    lowerMessage.includes("severe") ||
                    lowerMessage.includes("serious") ||
                    lowerMessage.includes("worst case") ||
                    lowerMessage.includes("deadly") ||
                    lowerMessage.includes("life threatening")) {
                    currentLevel = "comprehensive";
                } else if (lowerMessage.includes("more detail") || 
                          lowerMessage.includes("explain more") ||
                          lowerMessage.includes("what could")) {
                    currentLevel = "detailed";
                }
                
                // Get AI response
                getAIResponse(message);
            });

            // Helper function to add messages to chat
            function addMessageToChat(message, sender) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${sender}`;
                
                const messageContent = document.createElement('div');
                messageContent.className = 'message-content';
                messageContent.innerHTML = formatAIResponse(message);
                
                messageDiv.appendChild(messageContent);
                chatBody.appendChild(messageDiv);
                
                // Scroll to bottom
                chatBody.scrollTop = chatBody.scrollHeight;
            }

            // Find nearest doctors button
            findDoctorsBtn.addEventListener('click', function() {
                addMessageToChat("I'll help you find the right doctors. Let me ask you a few questions to provide the best recommendations.", 'bot');
                
                setTimeout(() => {
                    addMessageToChat("What type of symptoms are you experiencing? This will help me suggest the right specialist. You can also ask about serious conditions if you're concerned.", 'bot');
                }, 1500);
            });

            // Add some example questions to help users
            const exampleQuestions = [
                "I have headache and fever",
                "What causes stomach pain?",
                "How to relieve stress?",
                "When should I see a doctor?",
                "What could be serious about chest pain?",
                "Worst case for persistent headache"
            ];

            // Add placeholder suggestions to input
            chatInput.addEventListener('focus', function() {
                if (!this.value) {
                    this.placeholder = "e.g., " + exampleQuestions[Math.floor(Math.random() * exampleQuestions.length)];
                }
            });
        });

        function findNearDoctorForm() {
            console.log("worked")
            window.location.href="/patientPage/findNearDoctor"
        }
    </script>
</body>
</html>